# 复习辅助 Web 应用：需求文档（v0）

> 目标：做一款**通用**的复习/刷题/间隔重复（SRS）Web 应用；数据通过 GitHub 同步，换设备可无缝继续（数据一致）。

## 1. 背景与目标

### 1.1 背景

- “看懂≠记住”：需要通过**闭卷回忆（active recall）** + **间隔重复（spaced repetition）**来提升长期记忆。
- 现有工具要么偏卡片（不好做场景题/代码阅读），要么数据封闭（难以 Git 管理/迁移/同步）。

### 1.2 目标

- 支持多领域题库：概念题、机制题、场景选型题、代码阅读题、填空题等。
- 复习过程“闭卷优先”，可记录错因并形成“错题驱动复测”。
- 数据本地可用 + GitHub 同步：在不同电脑上使用同一份数据（题库 + 复习记录）。

### 1.3 非目标（v0）

- 不做“必须依赖大模型”的产品（LLM 作为后续可选插件）。
- 不强制做社交/公开题库市场。
- 不追求全平台原生客户端（先做 Web）。

## 2. 目标用户与使用场景

### 2.1 目标用户

- 学习/备考/面试复习的人群（开发、考证、语言学习等）。
- 偏“工程化记录”的用户：希望题库能放进 Git，能审查、回滚、迁移。

### 2.2 典型场景

- 早晨 10 分钟：只刷到期卡 + 错题复测（D+1/D+3/D+7）。
- 周末 30–60 分钟：专题学习 + 新增题库 + 复盘统计。
- 换设备：克隆/拉取 GitHub 数据仓库后继续刷题。

## 3. 核心概念定义

- **Deck（专题/题库）**：一组题目的集合，可按领域/章节/主题组织。
- **Item（题目）**：一道题（prompt）+ 可选标准答案要点（Markdown/多行）+ 标签/类型/难度。
- **Review（复习记录）**：某次对某题的作答与评分（v0 默认 `0/1/2`，映射 Again/Hard/Good；Easy 暂不启用）。
- **SRS（调度）**：根据历史评分决定下次复习时间。

## 4. 功能需求（按优先级）

### 4.1 MVP（必须做）

#### 4.1.1 题库管理

- 新建/编辑/删除 Deck。
- 新建/编辑/归档/恢复 Item。
- Item 字段：
  - 题干（必填，支持 Markdown）
  - 题型：概念/机制/场景选型/代码阅读/填空/选择等
  - 标签（多选）
  - 难度（可选）
  - 提示（可选，帮助回忆但不等同答案）
  - 标准要点（可选，支持 Markdown/多行，可复述）

#### 4.1.2 复习会话（闭卷）

- 今日任务：展示“到期题目数、错题复测数、新题数（可选）”。
- 会话模式：
  - 只展示题干（默认不展示提示/要点）。
  - 用户输入作答（文本即可，v0 不做自动判卷）。
  - 用户自评或按要点对照评分：`0/1/2`（可映射 SRS 等级）。
  - 记录错因分类：概念/机制/边界/工程实践（可多选）。
- 会话后输出：
  - 本次得分
  - 错题列表
  - “下次优先自问的 5 个问题”（从错因/错题中生成，允许手工编辑）

#### 4.1.3 SRS 调度

- 提供默认算法（v0：SM-2 或简化版本均可），并允许配置：
  - 每日上限（题数/分钟）
  - 新题与复习题比例
  - 评分映射策略（0/1/2 -> Again/Hard/Good）
- 支持“只复测错题”策略（特别适合学习新主题）。

#### 4.1.4 GitHub 同步（核心）

目标：把“题库 + 复习记录”落盘为一个**普通 Git 仓库**；你用 GitHub 作为远端，通过 `git pull`/`git push` 自己同步，换设备继续用。

- 支持选择本地“数据目录”（一个 Git 工作区/仓库）。
- 默认模式（MVP）：应用不接管 GitHub 认证，不保存 Token；应用只负责读写数据文件。
- 推荐工作流（单机自用 + 多设备切换）：
  - 开始复习前：先 `git pull`，确保本机数据最新。
  - 结束复习后：`git add -A` → `git commit -m ...` → `git push`。
  - 规则：尽量一次只在一台机器上复习；换机器前先 push，换机器后先 pull（避免冲突）。
- 冲突处理（MVP）：由用户在 Git 工具中手工解决；应用只提示“需要先同步/存在冲突”。
- 降低冲突的落盘策略：复习记录按日期/会话拆分，优先采用追加写（append-only，例如 `.jsonl`）。
- 可选增强（P1）：应用内“一键同步”（调用本机 `git`，复用你已有的 SSH/Git Credential/GitHub Desktop/gh 登录）。

#### 4.1.5 导入/导出

- 导出整个数据仓库（JSON/Markdown/CSV 至少一种）。
- 导入：
  - 从 Markdown/CSV/JSON 导入 Deck 与 Item（MVP 先支持一种即可，建议 JSON）。

#### 4.1.6 默认假设（v0，若未另行配置）

- 评分体系：仅使用 `0/1/2`，对应 Again/Hard/Good；Easy 暂不启用。
- 今日任务编排：到期题优先，其次错题复测，其次新题；达到每日上限时按该顺序截断。
- 错题判定与复测：评分为 `0` 视为错题；复测默认 D+1/D+3/D+7；复测仍写入 Review 并更新 SRS。
- SRS：默认采用“简化 SM-2”；初始 `easiness=2.5`；默认每日上限 50 题；新题比例 20%。
- 本次得分：默认展示平均分（0~2）+ 题量统计（0/1/2 分布）。
- Git 同步：只支持选择“已有 Git 仓库”目录；非 Git 目录提示用户自行 init/clone。
- 导入/导出：MVP 默认仅支持 JSON；导出包含 decks/items/config/reviews，允许勾选排除 reviews。
- 快照：默认记录最近一次成功同步的 commit hash 至 `config/last-sync.json`。

### 4.2 P1（强烈建议）

- 搜索与过滤：按 Deck/标签/题型/难度/到期时间过滤。
- 统计面板：
  - 连续复习天数、每日完成数
  - 错因分布（概念/机制/边界/工程）
  - Deck 掌握度（到期率、平均分、遗忘率近似）
- 复习策略：
  - “首轮只做 5 题，≥8/10 再升级到 10 题”的会话配置（可开关）。

### 4.3 P2（可选增强）

- 多用户：GitHub OAuth 登录；每个用户绑定自己的数据仓库。
- LLM 插件：
  - 从文档生成题目
  - 按要点评分（需用户授权与成本控制）
- 移动端适配：PWA 离线缓存（题库可离线读，记录待同步）。

## 5. 数据与存储（建议方案）

### 5.1 数据仓库（Git Repo）目录结构（建议）

> 目标：文本化、可 diff、尽量减少冲突。

- `decks/`：专题元数据
- `items/`：题目文件（建议一题一文件）
- `reviews/`：复习记录（建议按日期/会话拆分文件，尽量追加写）
- `config/`：算法与会话偏好（可选）

示例：

```
decks/<deckId>.json
items/<itemId>.json
reviews/2026-01-22/<sessionId>.jsonl
config/settings.json
```

### 5.2 最小字段建议（示意）

- Deck：
  - `deckId`：全局唯一（UUID）
  - `name`：名称
  - `description`：描述（可选）
  - `tags`：标签数组（可选）
  - `archived`：是否归档
  - `createdAt` / `updatedAt`
- Item：
  - `itemId`：全局唯一（UUID）
  - `deckId`
  - `type`：concept/mechanism/scenario/code/…
  - `prompt`：题干（支持 Markdown）
  - `hint`：提示（可选）
  - `answerMarkdown`：Markdown 要点（可选，字符串）
  - `tags`：标签数组
  - `difficulty`：难度（可选）
  - `archived`：是否归档
  - `srs`：调度状态（easiness、interval、due 等）
  - `createdAt` / `updatedAt`
- Review：
  - `reviewId`：全局唯一（UUID）
  - `itemId`
  - `deckId`
  - `sessionId`
  - `reviewedAt`
  - `score`：0/1/2
  - `answer`：用户作答（可选）
  - `reasonTags`：错因标签数组（可选）
- Settings（`config/settings.json`，示意）：
  - `dailyLimit`：每日上限（题数/分钟）
  - `newRatio`：新题比例
  - `scoreMap`：评分映射
  - `srsAlgo`：SRS 算法
  - `wrongReviewSchedule`：错题复测间隔（如 `[1,3,7]`）

## 6. 非功能性需求

### 6.1 安全

- 默认手动同步模式：应用不保存 GitHub Token（凭据由 Git/SSH/GitHub Desktop/gh 等工具管理）。
- 若启用“一键同步”（可选）：需要安全存储凭据（不明文落盘）：
  - 方案 A：本地加密文件 + 主密码
  - 方案 B：OS Keychain（后续）
- Web 运行模式：
  - 默认单机自用（localhost）
  - 若部署到服务器：必须有登录与 HTTPS（P2）

### 6.2 可用性与可靠性

- 同步前后必须有明确提示（成功/失败/冲突）。
- 所有写入应具备“可回滚”：
  - 写入前备份/快照（至少保留最近一次成功同步的 commit hash）。

### 6.3 可迁移性

- 数据仓库为“普通 Git 仓库”，不依赖特定数据库二进制文件。
- 允许用户把仓库迁移到别的平台（GitLab/Gitee）——Git 协议兼容即可（P1/P2）。

## 7. 页面与交互（MVP）

- 首页：今日任务、开始复习、同步状态
- Deck 列表：新建/编辑/导入/导出
- Deck 详情：题目列表、过滤、批量操作（归档/打标签）
- 复习页：题干 → 作答 → 评分 → 下一题
- 复盘页：错题列表、错因分布、下次 5 问
- 设置页：SRS 参数、会话策略、数据目录（Git 仓库）配置、（可选）一键同步

## 8. 里程碑与验收标准（建议）

### 8.1 v0.1（能用）

- 能建 Deck/题目
- 能开始复习并记录评分
- 能生成“今日到期任务”
- 数据以 Git 友好格式落盘，可手动 `pull/commit/push` 同步到 GitHub

### 8.2 v0.2（好用）

- 搜索过滤 + 统计面板
- 冲突提示清晰，复习日志冲突概率降低（按会话文件拆分）

### 8.3 v0.3（通用化）

- 完整导入导出格式
- OAuth 多用户（可选）
